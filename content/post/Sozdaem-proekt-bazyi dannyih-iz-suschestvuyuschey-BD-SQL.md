+++
title = "Создаем проект базы данных из существующей БД SQL"
date = "2019-10-20"
tags = [
    "MS SQL",
    "Visual Studio 2019",
    "Разработка проектов БД",
    "Database Project",
    "Базы данных"
]
+++

В этом посте мы увидим, как создается проект базы данных из существующей базы данных SQL. Мы изменим проект, добавив таблицу в проект и исходные данные через скрипт post deployment. Позже мы развернем этот проект на сервере SQL в качестве новой БД.

<!--more-->

### Введение
В настоящее время многие проекты строятся с непрерывной интеграцией и конвейером непрерывной доставки для создания и развертывания приложения в облаке или на локальном сервере. Легко выполнять CI/CD с проектами баз данных.  Работая в большой команде, сложно отслеживать изменения в одной и той же БД с несколькими изменениями от разных объектов. Каждый раз необходимо вручную обновлять локальную БД, когда другие пользователи вносят какие-либо изменения в свои объекты базы данных в том же приложении. В такой ситуации можно использовать проект БД с любым из распространенных инструментов репозитория, таких как TFS или GitHub, чтобы отслеживать все изменения в БД. Мы увидим, как создается проект базы данных из существующей базы данных, и как добавляется новая таблица в этот проект. Мы добавим некоторые исходные данные в новую таблицу, чтобы они автоматически добавлялись в новую базу данных во время развертывания проекта базы данных.

### Что нужно?
* Visual Studio 2019
* SQL Server 2017
Мы будем использовать пример БД Northwind для создания проекта базы данных.

#### Этап 1. Добавление БД в Visual Studio
Запускаем Visual Studio, выбираем SQL Server Object Explorer из меню View. Добавляем новый сервер, щелкая по узлу SQL Server правой кнопкой мыши.

![](https://i.postimg.cc/8C1jD7kX/gb0059.jpg)

Выбираем сервер из списка и предоставляем учетные данные. А также выбираем базу данных для проекта.

![](https://i.postimg.cc/NMnM1b6Z/gb0060.jpg)

В данном уроке я выбрал свой локальный сервер BASENJI и базу данных “ Northwind”. А также оставил по умолчанию проверку подлинности Windows для подключения к серверу. Если выбрать проверку подлинности SQL Server, то нужно верно указать свои имя пользователя и пароль. После того, как выбрали базу данных из списка, нажимаем кнопку “Connect”, чтобы продолжить работу. Теперь мы можем увидеть добавленный сервер в обозревателе SQL Server Object Explorer.

![](https://i.postimg.cc/d04D0JLs/gb0061.jpg)

Правой кнопкой щелкаем по базе данных и выбираем из меню “Create New Project…”.

![](https://i.postimg.cc/bJrrD4tQ/gb0062.jpg)

Выбираем допустимое имя и местоположение для проекта, потом нажимаем на кнопку “Start”. А также можем выбрать опцию разрешения на импорт, чтобы получить все разрешения, связанные с базой данных, если это необходимо.

![](https://i.postimg.cc/T2yjB44L/gb0063.jpg)

Это займет некоторое время, чтобы создать все объекты базы данных. Нажимаем кнопку “Finish” для завершения процесса.

![](https://i.postimg.cc/PfBbHQg6/gb0064.jpg)

Проект базы данных создается в указанной папке. Мы можем открыть проект и посмотреть его структуру.
Проект содержит все объекты БД в связанных папках. Здесь у нас есть таблицы, хранимые процедуры и представления только в проекте. Все объекты имеют отдельные файлы скриптов sql. Если у нас есть несколько схем, то эти объекты будут созданы под соответствующим именем папки. Итак, у нас есть все объекты по схеме dbo. Следовательно, эти объекты создаются в папке dbo.

![](https://i.postimg.cc/cC8JTYTC/gb0065.jpg)


#### Этап 2. Создание новой таблицы (Table) внутри проекта
Правой кнопкой мыши щелкаем по папке “Tables” и выбираем Add > New Item… Мы можем увидеть различные типы объектов в списке. Выбираем тип Table из списка и даем ему имя “Company”. Потом щелкаем по кнопке Add для продолжения.

![](https://i.postimg.cc/nMbhWzwk/gb0066.jpg)

Мы можем определить необходимые имена полей и типы для таблицы и щелкаем по кнопке Save на панели инструментов, чтобы сохранить таблицу.

![](https://i.postimg.cc/Jz8bD44Z/gb0067.jpg)

Мы можем создавать столько объектов, сколько захотим. В данном уроке мы создали только одну дополнительную таблицу.
Мы можем создать скрипт post deployment, чтобы загрузить данные в новую таблицу при развертывании базы данных на сервер.
Щелкаем правой кнопкой мыши на проект и выбираем из контекстного меню Add > New Item… Выбираем User Scripts, а потом “Post-Deployment Script” из списка объектов. Мы можем указать допустимое имя файла скрипта.

![](https://i.postimg.cc/9QByG5rS/gb0068.jpg)

Мы напишем запрос INSERT, чтобы добавить новую запись в таблицу Company. А также проверим наличие предыдущих записей в этой таблице. Таким образом, если снова опубликуем базу данных на том же сервере, то она не будет дублировать ту же запись.

![](https://i.postimg.cc/m2CYgFRT/gb0069.jpg)


#### Этап 3. Публикация проекта базы данных на SQL Server
Правой кнопкой мыши щелкаем на проект и выбираем “Publish…”. 
Появится окно “Publish Database”, в котором мы вносим изменения так, как показано ниже.

![](https://i.postimg.cc/cJ4wh93J/gb0070.jpg)

После того, как все это сделали, мы щелкаем по кнопке “Publish”, чтобы развернуть базу данных на сервере.
Ниже мы видим статус публикации в окне, как показано ниже.

![](https://i.postimg.cc/YSngs6Nz/gb0071.jpg)

Если во время развертывания произошла какая-то ошибка, то мы можем щелкнуть по ссылке “View Results”, чтобы получить точные сведения об этой ошибке.
Мы можем посмотреть только что созданную таблицу и запись в обозревателе объектов. Открываем экземпляр SQL Server из SSMS или Visual Studio.

![](https://i.postimg.cc/TwKmMKCM/gb0072.jpg)

Мы можем изменять объекты в проекте базы данных в соответствии с нашими требованиями и снова разворачивать их в той же БД. Это не повлияет на существующие данные в БД. Мы можем легко добавлять или удалять столбец в/из таблицы или изменять хранимую процедуру с помощью проекта БД. Если идет работа с большой командой над одним приложением, то легко работать совместно, используя проект базы данных.

### Вывод
В данном уроке мы узнали, как создать проект базы данных из существующей БД SQL и добавлять в проект новую таблицу. А также добавили исходные данные в таблицу внутри скрипта post-deployment. Успешно опубликовали проект базы данных на локальном сервере SQL. Как уже ранее упоминалось, проекты баз данных очень полезны для работы в большой команде, и их легко выполнять с помощью непрерывной интеграции и непрерывных конвейеров доставки. Это позволит уменьшить головную боль разработчикам SQL для поддержания скриптов обновления во всем приложении. Несколько человек могут работать с одним объектом базы данных и очень легко отслеживать изменения.

Переведен и переработан [оригинал](https://www.c-sharpcorner.com/article/create-a-database-project-from-existing-sql-database/)